<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fest Photo Booth</title>
    <style>
        body { 
            margin: 0; background: #000; color: white; font-family: sans-serif; 
            overflow: hidden; height: 100vh; width: 100vw;
        }

        #camera-container, #preview-container { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
        }

        video, #last-photo { 
            width: 100%; height: 100%; object-fit: cover; 
        }

        /* Spegelvänd kameran, men INTE den färdiga bilden */
        video { transform: scaleX(-1); }

        #preview-container {
            display: none; /* Dold som standard */
            z-index: 50;
            background: #000;
        }

        #btn-capture { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0); border: none; cursor: pointer; z-index: 100;
            display: flex; align-items: flex-end; justify-content: center; padding-bottom: 40px;
        }

        #hint-text {
            color: white; font-size: 1.5rem; font-weight: bold; text-transform: uppercase;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.8); background: rgba(0,0,0,0.3);
            padding: 10px 20px; border-radius: 50px; pointer-events: none;
        }

        #countdown { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 250px; font-weight: bold; text-shadow: 0 0 30px rgba(0,0,0,0.8); 
            z-index: 110; pointer-events: none;
        }

        #flash { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: white; opacity: 0; pointer-events: none; z-index: 200;
        }
    </style>
</head>
<body>
<audio id="shutter-sound" preload="auto">
    <source src="https://www.soundjay.com/mechanical/camera-shutter-click-08.mp3" type="audio/mpeg">
</audio>
<div id="camera-container">
    <video id="webcam" autoplay playsinline></video>
</div>

<div id="preview-container">
    <img id="last-photo" src="" alt="Ditt foto">
    <div style="position:absolute; bottom:20px; width:100%; text-align:center;">
        <span id="hint-text" style="background:rgba(0,150,0,0.7)">BILD SPARAD!</span>
    </div>
</div>

<button id="btn-capture">
    <span id="hint-text">Tryck var som helst för att ta bild</span>
</button>

<div id="countdown"></div>
<div id="flash"></div>

<canvas id="photo-canvas" style="display:none;"></canvas>

<script>
    const video = document.getElementById('webcam');
    const canvas = document.getElementById('photo-canvas');
    const countdownEl = document.getElementById('countdown');
    const flash = document.getElementById('flash');
    const btn = document.getElementById('btn-capture');
    const hintText = document.getElementById('hint-text');
    const previewContainer = document.getElementById('preview-container');
    const lastPhotoImg = document.getElementById('last-photo');

    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwaC1SrZFqlMndjBRk6aVJY5pBr3TAkyMJr48Xz_YxiUEL7mDiYdlJenyRGwuxBPd4mwg/exec"; // Använd din URL

    async function initCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: "user", width: { ideal: 1920 }, height: { ideal: 1080 } }
            });
            video.srcObject = stream;
        } catch (err) { alert("Kameran kunde inte startas."); }
    }

async function takePhoto() {
    // 1. Aktivera fullskärm (krävs för ljud/video på Android)
    if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
    
    btn.style.pointerEvents = 'none';
    hintText.style.opacity = '0';
    
    // 2. Nedräkning
    for (let i = 5; i > 0; i--) {
        countdownEl.innerText = i;
        await new Promise(r => setTimeout(r, 1000));
    }
    countdownEl.innerText = "";

    // 3. LJUD & BLIXT (Sker samtidigt)
    const shutterSound = document.getElementById('shutter-sound');
    shutterSound.play().catch(e => console.log("Ljud blockerat av webbläsare"));

    flash.style.opacity = 1;
    setTimeout(() => flash.style.opacity = 0, 150);

    // 4. Fånga bilden
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.translate(canvas.width, 0);
    ctx.scale(-1, 1);
    ctx.drawImage(video, 0, 0);

    // ... resten av koden (visa förhandsvisning och skicka till Drive)


        const imageData = canvas.toDataURL('image/jpeg', 0.85);
        
        // --- NYTT: Visa bilden direkt ---
        lastPhotoImg.src = imageData;
        previewContainer.style.display = 'block';

        // Skicka i bakgrunden
        const base64Clean = imageData.split(',')[1];
        fetch(WEB_APP_URL, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify({ image: base64Clean, filename: "fest_" + Date.now() + ".jpg" })
        });
        
        // Vänta 4 sekunder så folk hinner se bilden, återgå sedan till kameran
        setTimeout(() => {
            previewContainer.style.display = 'none';
            btn.style.pointerEvents = 'auto';
            hintText.style.opacity = '1';
        }, 7000);
    }

    btn.addEventListener('click', takePhoto);
    initCamera();
</script>
</body>
</html>
<!--
<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fest Photo Booth</title>
    <style>
        body { 
            margin: 0; 
            background: #000; 
            color: white; 
            font-family: sans-serif; 
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
        }

        /* Kameran täcker hela bakgrunden */
        #camera-container { 
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        video { 
            width: 100%; height: 100%; 
            object-fit: cover; 
            transform: scaleX(-1); 
        }

        /* Den osynliga knappen som täcker ALLT */
        #btn-capture { 
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0); /* Helt transparent */
            border: none;
            cursor: pointer;
            z-index: 10; /* Ligger överst */
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 40px;
        }

        /* Hjälptext som syns när kameran är redo */
        #hint-text {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            text-transform: uppercase;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.8);
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 50px;
            pointer-events: none; /* Texten stör inte klicket */
        }

        #countdown { 
            position: absolute; 
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 250px; font-weight: bold; 
            text-shadow: 0 0 30px rgba(0,0,0,0.8); 
            z-index: 100;
            pointer-events: none;
        }

        #flash { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: white; opacity: 0; pointer-events: none; z-index: 200;
        }
    </style>
</head>
<body>

<div id="camera-container">
    <video id="preview" autoplay playsinline></video>
</div>

<button id="btn-capture">
    <span id="hint-text">Tryck var som helst för att ta bild</span>
</button>

<div id="countdown"></div>
<div id="flash"></div>

<canvas id="photo-canvas" style="display:none;"></canvas>

<script>
    const video = document.getElementById('preview');
    const canvas = document.getElementById('photo-canvas');
    const countdownEl = document.getElementById('countdown');
    const flash = document.getElementById('flash');
    const btn = document.getElementById('btn-capture');
    const hintText = document.getElementById('hint-text');

    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwaC1SrZFqlMndjBRk6aVJY5pBr3TAkyMJr48Xz_YxiUEL7mDiYdlJenyRGwuxBPd4mwg/exec";

    async function initCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: "user", width: { ideal: 1920 }, height: { ideal: 1080 } }
            });
            video.srcObject = stream;
        } catch (err) {
            alert("Kameran kunde inte startas.");
        }
    }

    function enableFullScreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(() => {});
        }
    }

    async function takePhoto() {
        enableFullScreen();
        
        // Inaktivera klick under processen
        btn.style.pointerEvents = 'none';
        hintText.style.opacity = '0';
        
        // Nedräkning
        for (let i = 3; i > 0; i--) {
            countdownEl.innerText = i;
            await new Promise(r => setTimeout(r, 1000));
        }
        countdownEl.innerText = "SMILE!";
        await new Promise(r => setTimeout(r, 400));
        countdownEl.innerText = "";

        // Blixt
        flash.style.opacity = 1;
        setTimeout(() => flash.style.opacity = 0, 150);

        // Fånga bild
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
        ctx.drawImage(video, 0, 0);

        const imageData = canvas.toDataURL('image/jpeg', 0.85);
        
        // Skicka
        const base64Clean = imageData.split(',')[1];
        fetch(WEB_APP_URL, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify({ image: base64Clean, filename: "fest_" + Date.now() + ".jpg" })
        });
        
        // Återställ efter paus
        setTimeout(() => {
            btn.style.pointerEvents = 'auto';
            hintText.style.opacity = '1';
        }, 3000);
    }

    btn.addEventListener('click', takePhoto);
    initCamera();
</script>
</body>
</html>
-->